/* Goo Engine gizmopack 
 * Copyright 2014 Goo Technologies AB
 */
(function(window){function f(){
define("goo/util/gizmopack/Gizmo",["goo/renderer/shaders/ShaderBuilder","goo/renderer/MeshData","goo/renderer/Shader","goo/renderer/Material","goo/renderer/Renderer","goo/math/Transform","goo/math/Matrix4x4","goo/math/Plane","goo/math/Ray","goo/math/Vector3","goo/renderer/Camera"],function(e,t,n,r,i,s,o,u,a,f,l){function c(e,t){this.name=e||"Default Gizmo",this.gizmoRenderSystem=t,this._colors=[[1,.1,.3],[.2,1,.3],[.2,.3,1],[.8,.8,.8]],this._gizmoSize=1/60,this._plane=new u,this._line=new f,this._activeHandle=null,this._mouse={position:[0,0],oldPosition:[0,0]},this.dirty=!1,this.visible=!1,this.transform=new s,this.renderables=[],this.onChange=null,this._oldRay=new a,this._newRay=new a,this._result=new f,this._v0=new f,this._v1=new f,this._v2=new f,this._v3=new f,this._s0=new f,this._s1=new f,this._s2=new f,this._s3=new f}return c.handleStore=[],c.registerHandle=function(e){var t=c.handleStore.length+16e3;return c.handleStore.push(e),t},c.getHandle=function(e){return e<16e3?null:c.handleStore[e-16e3]},c.prototype.getRenderable=function(e){for(var t=0;t<this.renderables.length;t++){var n=this.renderables[t];if(n.id===e)return n}},c.prototype.activate=function(e){this._activeHandle=e.data,this._mouse.oldPosition[0]=e.x,this._mouse.oldPosition[1]=e.y,this._activeRenderable=this.getRenderable(e.id),this._activeRenderable.materials[0].uniforms.color=[1,1,0]},c.prototype.deactivate=function(){if(this._activeRenderable){var e=this._activeRenderable.originalColor;this._activeRenderable.materials[0].uniforms.color=[e[0],e[1],e[2]]}},c.prototype.copyTransform=function(e){this.transform.setIdentity(),e&&(e.matrix.getTranslation(this.transform.translation),this.transform.rotation.copy(e.rotation),this.updateTransforms())},c.prototype.update=function(e){this._mouse.position[0]=e[0],this._mouse.position[1]=e[1],this.dirty=!0},c.prototype.updateTransforms=function(){if(i.mainCamera){var e=i.mainCamera,t;if(e.projectionMode===l.Perspective){var n=e.translation.distance(this.transform.translation);t=n*this._gizmoSize}else t=(e._frustumTop-e._frustumBottom)/30;this.transform.scale.setd(t,t,t)}this.transform.update();for(var r=this.renderables.length-1;r>=0;r--)this.renderables[r].transform.update(),o.combine(this.transform.matrix,this.renderables[r].transform.matrix,this.renderables[r].transform.matrix)},c.prototype._setPlane=function(){var e=this._plane.normal,t=this._v0,n=this._v1,r=this._v2,s=this._v3,o=this._s0,u=this._s1,a=this._s2,l=this._s3;this._activeHandle.type==="Plane"?(e.setv([f.UNIT_X,f.UNIT_Y,f.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(e),e.normalize(),t.setv(f.ZERO),this.transform.matrix.applyPostPoint(t),this._plane.constant=t.dot(e)):(t.setv(f.ZERO),this.transform.matrix.applyPostPoint(t),n.setv(f.UNIT_X),this.transform.matrix.applyPostPoint(n),r.setv(f.UNIT_Y),this.transform.matrix.applyPostPoint(r),s.setv(f.UNIT_Z),this.transform.matrix.applyPostPoint(s),i.mainCamera.getScreenCoordinates(t,1,1,o),i.mainCamera.getScreenCoordinates(n,1,1,u),u.subv(o),i.mainCamera.getScreenCoordinates(r,1,1,a),a.subv(o),i.mainCamera.getScreenCoordinates(s,1,1,l),l.subv(o),this._activeHandle.axis===0?a.cross(u).length()>l.cross(u).length()?e.setv(s).subv(t).normalize():e.setv(r).subv(t).normalize():this._activeHandle.axis===1?l.cross(a).length()>u.cross(a).length()?e.setv(n).subv(t).normalize():e.setv(s).subv(t).normalize():u.cross(l).length()>a.cross(l).length()?e.setv(r).subv(t).normalize():e.setv(n).subv(t).normalize(),this._plane.constant=t.dot(e))},c.prototype._setLine=function(){this._line.setv([f.UNIT_X,f.UNIT_Y,f.UNIT_Z][this._activeHandle.axis]),this.transform.matrix.applyPostVector(this._line),this._line.normalize()},c.prototype.addRenderable=function(e){e.originalColor=e.materials[0].uniforms.color,this.renderables.push(e)},c.prototype._buildMaterialForAxis=function(e,t){var n=new r(c._shaderDef,e+"Material");return n.uniforms.color=this._colors[e],t!==undefined&&t<1&&(n.blendState.blending="CustomBlending",n.uniforms.opacity=t,n.renderQueue=3e3),n.cullState.enabled=!1,n},c._shaderDef={attributes:{vertexPosition:t.POSITION,vertexNormal:t.NORMAL},uniforms:{viewProjectionMatrix:n.VIEW_PROJECTION_MATRIX,worldMatrix:n.WORLD_MATRIX,cameraPosition:n.CAMERA,color:[1,1,1],opacity:1,light:[-20,20,20]},vshader:["attribute vec3 vertexPosition;","attribute vec3 vertexNormal;","uniform mat4 viewProjectionMatrix;","uniform mat4 worldMatrix;","uniform vec3 cameraPosition;","varying vec3 normal;","varying vec3 viewPosition;","void main(void) {","	vec4 worldPos = worldMatrix * vec4(vertexPosition, 1.0);","	gl_Position = viewProjectionMatrix * worldPos;","	normal = vertexNormal;","	viewPosition = cameraPosition - worldPos.xyz;","}"].join("\n"),fshader:["varying vec3 normal;","varying vec3 viewPosition;","uniform vec3 color;","uniform float opacity;","uniform vec3 light;","void main(void)","{","	vec3 N = normalize(normal);","	vec4 final_color = vec4(color, 1.0);"," vec3 lVector = normalize(light);"," float dotProduct = dot(N, lVector);"," float diffuse = max(dotProduct, 0.0);"," final_color.rgb *= (0.5*diffuse+0.5);"," final_color.a = opacity;","	gl_FragColor = final_color;","}"].join("\n")},c}),define("goo/util/gizmopack/TranslationGizmo",["goo/util/gizmopack/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Disk","goo/shapes/Quad","goo/math/Transform","goo/renderer/Renderer"],function(e,t,n,r,i,s,o){function u(){e.call(this,"TranslationGizmo"),this._quadMesh=new i(2,2),this._arrowMesh=this._buildArrowMesh(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return u.prototype=Object.create(e.prototype),u.prototype.activate=function(t){e.prototype.activate.call(this,t),this._setPlane(),this._activeHandle.type==="Axis"&&this._setLine()},u.prototype.process=function(){var e=this._mouse.oldPosition,t=this._mouse.position;o.mainCamera.getPickRay(e[0],e[1],1,1,this._oldRay),o.mainCamera.getPickRay(t[0],t[1],1,1,this._newRay),this._activeHandle.type==="Plane"?this._moveOnPlane():this._activeHandle.type==="Axis"&&this._moveOnLine(),e[0]=t[0],e[1]=t[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.translation)},u.prototype.copyTransform=function(t,n){e.prototype.copyTransform.call(this,t),t&&n&&(this.transform.rotation.setIdentity(),this.updateTransforms())},u.prototype._moveOnPlane=function(){var e=this._v0,t=this._v1,n=this._result;this._plane.rayIntersect(this._oldRay,e,!0),this._plane.rayIntersect(this._newRay,t,!0),n.setv(t).subv(e),this.transform.translation.add(n)},u.prototype._moveOnLine=function(){var e=this._v0,t=this._v1,n=this._result,r=this._line;this._plane.rayIntersect(this._oldRay,e,!0),this._plane.rayIntersect(this._newRay,t,!0),n.setv(t).subv(e);var i=n.dot(r);n.setv(r).muld(i,i,i),this.transform.translation.addv(n)},u.prototype._buildArrow=function(t){var n=new s,r=new s,i=1;r.scale.setd(i,i,i),t===2?r.translation.setd(i,i,0):t===0?(r.translation.setd(0,i,i),r.setRotationXYZ(0,Math.PI/2,0),n.setRotationXYZ(0,Math.PI/2,0)):t===1&&(r.translation.setd(i,0,i),r.setRotationXYZ(Math.PI/2,0,0),n.setRotationXYZ(Math.PI*3/2,0,0)),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(t)],transform:n,id:e.registerHandle({type:"Axis",axis:t}),thickness:.6}),this.addRenderable({meshData:this._quadMesh,materials:[this._buildMaterialForAxis(t,.6)],transform:r,id:e.registerHandle({type:"Plane",axis:t})})},u.prototype._buildArrowMesh=function(){var e=new n,i=new r(32,.6,2.3),o=new r(32,.6),u=new t(t.defaultMap([t.POSITION]),2,2);u.getAttributeBuffer(t.POSITION).set([0,0,0,0,0,7]),u.getIndexBuffer().set([0,1]),u.indexLengths=null,u.indexModes=["Lines"];var a=new s;a.translation.setd(0,0,7),a.update(),e.addMeshData(i,a),a.setRotationXYZ(0,Math.PI,0),a.update(),e.addMeshData(o,a);var a=new s;a.update(),e.addMeshData(u,a);var f=e.build()[0];return f},u}),define("goo/util/gizmopack/RotationGizmo",["goo/util/gizmopack/Gizmo","goo/shapes/Sphere","goo/shapes/Torus","goo/math/Vector3","goo/math/Matrix3x3","goo/math/Transform","goo/renderer/Renderer","goo/math/Ray"],function(e,t,n,r,i,s,o,u){function a(){e.call(this,"RotationGizmo"),this._ballMesh=new t(32,32,1.1),this._torusMesh=new n(64,8,.1,2.5),this._buildBall(),this._buildTorus(0),this._buildTorus(1),this._buildTorus(2),this._rotation=new i,this._rotationScale=4,this._axis=new r,this._direction=new r,this._ray=new u,this._m1=new i,this._m2=new i,this.snap=!1,this.accumulatedRotationX=0,this.accumulatedRotationY=0,this.accumulatedRotationThorX=0,this.accumulatedRotationThorY=0,this.accumulatedRotationThorZ=0,this.oldAngleX=0,this.oldAngleY=0,this.oldAngleZ=0}function f(e,t){return function(n){var r=n%e;return r+=r<0?e:0,r<t?n-r:r>e-t?n+e-r:n}}a.prototype=Object.create(e.prototype),a.prototype.activate=function(t){e.prototype.activate.call(this,t);var n=this._v0,i=this._v1,s=this._v2,u=this._axis,a=this._ray;if(this._activeHandle.axis<3){u.setv([r.UNIT_X,r.UNIT_Y,r.UNIT_Z][this._activeHandle.axis]),this.transform.rotation.applyPost(u),n.setv(r.ZERO),this.transform.matrix.applyPostPoint(n),o.mainCamera.getPickRay(t.x,t.y,1,1,a),i.setv(a.origin).subv(n);var f=i.length()*.9;i.setv(a.direction).muld(f,f,f).addv(a.origin),s.setv(i).subv(n),r.cross(u,s,s),s.addv(i),o.mainCamera.getScreenCoordinates(s,1,1,this._direction),this._direction.sub_d(t.x,t.y,0),this._direction.z=0,this._direction.normalize()}},a.prototype.process=function(){var e=this._mouse.oldPosition,t=this._mouse.position,n=t[0]-e[0],r=t[1]-e[1];this._activeHandle.axis===3?this._rotateOnScreen(n,r):this._rotateOnAxis(n,r),e[0]=t[0],e[1]=t[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this.transform.rotation)},a.prototype._rotateOnScreen=function(e,t){this._rotation.setIdentity();if(this.snap&&!1){this.accumulatedRotationY+=e*this._rotationScale,this.accumulatedRotationX+=t*this._rotationScale;var n=Math.PI/8;this.accumulatedRotationX>n?(this.accumulatedRotationX-=n,this._rotation.rotateX(n)):this.accumulatedRotationX<0&&(this.accumulatedRotationX+=n,this._rotation.rotateX(-n)),this.accumulatedRotationY>n?(this.accumulatedRotationY-=n,this._rotation.rotateY(n)):this.accumulatedRotationY<0&&(this.accumulatedRotationY+=n,this._rotation.rotateY(-n))}else this._rotation.rotateY(e*this._rotationScale),this._rotation.rotateX(t*this._rotationScale);var r=o.mainCamera.getViewMatrix().data,s=this._m1,u=this._m2;s.set(r[0],r[1],r[2],r[4],r[5],r[6],r[8],r[9],r[10]),u.set(s).invert(),u.combine(this._rotation),u.combine(s),i.combine(u,this.transform.rotation,this.transform.rotation)};var l=f(Math.PI/4,Math.PI/16),c=l;return a.prototype._rotateOnAxis=function(e,t){this._rotation.setIdentity();var n=e*this._direction.x+t*this._direction.y;n*=this._rotationScale;if(this.snap)switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=n;var r=c(this.accumulatedRotationThorX);this._rotation.rotateX(r-this.oldAngleX),this.oldAngleX=r;break;case 1:this.accumulatedRotationThorY+=n;var s=c(this.accumulatedRotationThorY);this._rotation.rotateY(s-this.oldAngleY),this.oldAngleY=s;break;case 2:this.accumulatedRotationThorZ+=n;var o=c(this.accumulatedRotationThorZ);this._rotation.rotateZ(o-this.oldAngleZ),this.oldAngleZ=o}else switch(this._activeHandle.axis){case 0:this.accumulatedRotationThorX+=n;var r=this.accumulatedRotationThorX;this._rotation.rotateX(r-this.oldAngleX),this.oldAngleX=r;break;case 1:this.accumulatedRotationThorY+=n;var s=this.accumulatedRotationThorY;this._rotation.rotateY(s-this.oldAngleY),this.oldAngleY=s;break;case 2:this.accumulatedRotationThorZ+=n;var o=this.accumulatedRotationThorZ;this._rotation.rotateZ(o-this.oldAngleZ),this.oldAngleZ=o}i.combine(this.transform.rotation,this._rotation,this.transform.rotation)},a.prototype._buildBall=function(){var t=new s;t.scale.setd(1.2,1.2,1.2),this.addRenderable({meshData:this._ballMesh,materials:[this._buildMaterialForAxis(3,.6)],transform:new s,id:e.registerHandle({type:"Rotate",axis:3})})},a.prototype._buildTorus=function(t){var n=new s;n.scale.setd(1.7,1.7,1.7),t===0?n.setRotationXYZ(0,Math.PI/2,0):t===1&&n.setRotationXYZ(Math.PI/2,0,0),this.addRenderable({meshData:this._torusMesh,materials:[this._buildMaterialForAxis(t)],transform:n,id:e.registerHandle({type:"Rotate",axis:t}),thickness:.35})},a}),define("goo/util/gizmopack/ScaleGizmo",["goo/util/gizmopack/Gizmo","goo/renderer/MeshData","goo/util/MeshBuilder","goo/shapes/Box","goo/math/Transform","goo/renderer/Renderer","goo/math/Vector3","goo/math/MathUtils"],function(e,t,n,r,i,s,o,u){function a(t){e.call(this,"ScaleGizmo",t),this._boxMesh=new r(1.4,1.4,1.4),this._arrowMesh=this._buildArrowMesh(),this._scale=1,this._transformScale=new o,this._transformScale.setd(1,1,1),this._buildBox(),this._buildArrow(0),this._buildArrow(1),this._buildArrow(2)}return a.prototype=Object.create(e.prototype),a.prototype.activate=function(t){e.prototype.activate.call(this,t),this._activeHandle.axis!==3&&(this._setPlane(),this._setLine())},a.prototype.copyTransform=function(t){e.prototype.copyTransform.call(this,t),this._transformScale.setv(t.scale)},a.prototype.process=function(){var e=this._mouse.oldPosition,t=this._mouse.position;this._activeHandle.axis===3?this._scaleUniform():this._scaleNonUniform(),e[0]=t[0],e[1]=t[1],this.updateTransforms(),this.dirty=!1,this.onChange instanceof Function&&this.onChange(this._transformScale)},a.prototype._scaleUniform=function(){var e=this._mouse.oldPosition,t=this._mouse.position,n=Math.pow(1+t[0]+e[1]-e[0]-t[1],this._scale),r=this.gizmoRenderSystem.entity.transformComponent.worldTransform.translation,i=s.mainCamera.translation,o=i.distance(r);n+=o/2e5*u.sign(n-1),this._transformScale.muld(n,n,n)},a.prototype._scaleNonUniform=function(){var e=this._mouse.position,t=this._mouse.oldPosition;s.mainCamera.getPickRay(t[0],t[1],1,1,this._oldRay),s.mainCamera.getPickRay(e[0],e[1],1,1,this._newRay);var n=this._v0,r=this._v1,i=this._line,o=this._result;this._plane.rayIntersect(this._oldRay,n),this._plane.rayIntersect(this._newRay,r),o.setv(r).subv(n),o.div(this.transform.scale).scale(.07);var u=o.dot(i);o.setv(i).muld(u,u,u);var a=Math.pow(1+u,this._scale);switch(this._activeHandle.axis){case 0:this._transformScale.data[0]*=a;break;case 1:this._transformScale.data[1]*=a;break;case 2:this._transformScale.data[2]*=a}},a.prototype._buildBox=function(){this.addRenderable({meshData:this._boxMesh,materials:[this._buildMaterialForAxis(3)],transform:new i,id:e.registerHandle({type:"Scale",axis:3})})},a.prototype._buildArrow=function(t){var n=new i;t===0?n.setRotationXYZ(0,Math.PI/2,0):t===1&&n.setRotationXYZ(Math.PI*3/2,0,0),this.addRenderable({meshData:this._arrowMesh,materials:[this._buildMaterialForAxis(t)],transform:n,id:e.registerHandle({type:"Scale",axis:t})})},a.prototype._buildArrowMesh=function(){var e=new n,s=new r,o=new t(t.defaultMap([t.POSITION]),2,2);o.getAttributeBuffer(t.POSITION).set([0,0,0,0,0,1]),o.getIndexBuffer().set([0,1]),o.indexLengths=null,o.indexModes=["Lines"];var u=new i;u.translation.setd(0,0,8),u.update(),e.addMeshData(s,u);var u=new i;u.scale.setd(1,1,8),u.update(),e.addMeshData(o,u);var a=e.build()[0];return a},a}),define("goo/util/gizmopack/GizmoRenderSystem",["goo/entities/systems/System","goo/entities/SystemBus","goo/renderer/SimplePartitioner","goo/renderer/Material","goo/renderer/shaders/ShaderLib","goo/renderer/shaders/ShaderFragment","goo/renderer/Util","goo/math/Matrix3x3","goo/math/Matrix4x4","goo/renderer/MeshData","goo/renderer/Shader","goo/util/gizmopack/Gizmo","goo/util/gizmopack/TranslationGizmo","goo/util/gizmopack/RotationGizmo","goo/util/gizmopack/ScaleGizmo"],function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d){function v(n){e.call(this,"GizmoRenderSystem",null),this.renderables=[],this.camera=null,this.gizmos=[new h(this),new p(this),new d(this)],this.active=!1,this.nextGizmo=null,this.setupCallbacks(n),this.activeGizmo=null,this.viewportWidth=0,this.viewportHeight=0,this.domElement=null,this.global=!1,this.pickingMaterial=r.createEmptyMaterial(m,"pickingMaterial"),this.pickingMaterial.blendState={blending:"NoBlending",blendEquation:"AddEquation",blendSrc:"SrcAlphaFactor",blendDst:"OneMinusSrcAlphaFactor"},this._devicePixelRatio=1,this.mouseMove=function(e){if(!this.activeGizmo)return;var t=e.offsetX!==undefined?e.offsetX:e.layerX,n=e.offsetY!==undefined?e.offsetY:e.layerY,r=[t/(this.viewportWidth/this._devicePixelRatio),n/(this.viewportHeight/this._devicePixelRatio)];this.activeGizmo.update(r)}.bind(this);var i=this;t.addListener("goo.setCurrentCamera",function(e){i.camera=e.camera})}v.prototype=Object.create(e.prototype),v.prototype.activate=function(e,t,n){this.active=!0;var r=c.getHandle(e);r&&this.activeGizmo&&(this.activeGizmo.activate({id:e,data:r,x:t/(this.viewportWidth/this._devicePixelRatio),y:n/(this.viewportHeight/this._devicePixelRatio)}),this.domElement.addEventListener("mousemove",this.mouseMove))},v.prototype.deactivate=function(){this.activeGizmo.deactivate(),this.active=!1,this.domElement.removeEventListener("mousemove",this.mouseMove),this.nextGizmo!==null&&(this.setActiveGizmo(this.nextGizmo),this.nextGizmo=null)},v.prototype.getGizmo=function(e){return this.gizmos[e]},v.prototype.show=function(e){this.entity=e,this.activeGizmo&&(this.entity?this.showGizmo(this.activeGizmo):this.hideGizmo(this.activeGizmo))},v.prototype.showGizmo=function(e){e.copyTransform(this.entity.transformComponent.worldTransform,this.global),e.visible||(this.renderables=e.renderables,e.visible=!0)},v.prototype.hideGizmo=function(e){e.visible&&(this.renderables=[],e.visible=!1)},v.prototype.setActiveGizmo=function(e){if(this.active){this.nextGizmo=e;return}this.activeGizmo&&this.hideGizmo(this.activeGizmo),this.activeGizmo=this.gizmos[e]||null,this.activeGizmo&&this.entity&&this.showGizmo(this.activeGizmo)},v.prototype.setGlobal=function(e){this.global!==e&&(this.global=!!e,this.entity&&this.activeGizmo&&this.showGizmo(this.activeGizmo))},v.prototype.setupCallbacks=function(e){if(e&&e.length===3){this.gizmos[0].onChange=e[0],this.gizmos[1].onChange=e[1],this.gizmos[2].onChange=e[2];return}var t=new u,n=new a;this.gizmos[0].onChange=function(e){if(this.entity){var t=this.entity.transformComponent.transform.translation;t.setv(e),this.entity.transformComponent.parent&&(n.copy(this.entity.transformComponent.parent.worldTransform.matrix),n.invert(),n.applyPostPoint(t)),this.entity.transformComponent.setUpdated()}}.bind(this),this.gizmos[1].onChange=function(e){this.entity&&(this.entity.transformComponent.transform.rotation.copy(e),this.entity.transformComponent.parent&&(t.copy(this.entity.transformComponent.parent.worldTransform.rotation),t.invert()),u.combine(t,this.entity.transformComponent.transform.rotation,this.entity.transformComponent.transform.rotation),this.entity.transformComponent.setUpdated())}.bind(this),this.gizmos[2].onChange=function(e){if(this.entity){var t=this.entity.transformComponent.transform.scale;t.setv(e),this.entity.transformComponent.parent&&t.div(this.entity.transformComponent.parent.worldTransform.scale),this.entity.transformComponent.setUpdated()}}.bind(this)},v.prototype.inserted=function(){},v.prototype.deleted=function(){},v.prototype.process=function(){this.activeGizmo&&(this.activeGizmo.dirty?this.activeGizmo.process():this.entity&&this.entity.transformComponent._updated&&!this.active&&this.activeGizmo.copyTransform(this.entity.transformComponent.worldTransform,this.global),this.activeGizmo.updateTransforms())},v.prototype.render=function(e){e.checkResize(this.camera),this._devicePixelRatio=e._useDevicePixelRatio&&window.devicePixelRatio?window.devicePixelRatio/e.svg.currentScale:1,this.domElement||(this.domElement=e.domElement),this.viewportHeight=e.viewportHeight,this.viewportWidth=e.viewportWidth,this.camera&&e.render(this.renderables,this.camera,this.lights,null,{color:!1,stencil:!0,depth:!0},this.overrideMaterials)},v.prototype.renderToPick=function(e,t){for(var n=0;n<this.renderables.length;n++){var r=this.renderables[n];r.thickness!==undefined&&(r.materials[0].uniforms.thickness=r.thickness)}e.renderToPick(this.renderables,this.camera,{color:!1,stencil:!0,depth:!0},t,undefined,undefined,undefined,this.pickingMaterial);for(var n=0;n<this.renderables.length;n++){var r=this.renderables[n];r.thickness&&(r.materials[0].uniforms.thickness=0)}};var m={attributes:{vertexPosition:f.POSITION,vertexNormal:f.NORMAL},processors:[function(e,t){var n=t.meshData.attributeMap;e.defines=e.defines||{};for(var r in n)e.defines[r]||(e.defines[r]=!0)}],uniforms:{viewMatrix:l.VIEW_MATRIX,projectionMatrix:l.PROJECTION_MATRIX,worldMatrix:l.WORLD_MATRIX,cameraFar:l.FAR_PLANE,thickness:0,id:function(e){return e.renderable.id+1}},vshader:["attribute vec3 vertexPosition;","#ifdef NORMAL","attribute vec3 vertexNormal;","#endif","uniform mat4 viewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 worldMatrix;","uniform float cameraFar;","uniform float thickness;","varying float depth;","void main() {","#ifdef NORMAL","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition + vertexNormal * thickness, 1.0 );","#else","vec4 mvPosition = viewMatrix * worldMatrix * vec4( vertexPosition, 1.0 );","#endif","depth = length(mvPosition.xyz) / cameraFar;","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fshader:["uniform float id;","varying float depth;",s.methods.packDepth16,"void main() {","vec2 packedId = vec2(floor(id/255.0), mod(id, 255.0)) * vec2(1.0/255.0);","vec2 packedDepth = packDepth16(depth);","gl_FragColor = vec4(packedId, packedDepth);","}"].join("\n")};return v}),define("goo/util/gizmopack/GizmoRegister",["goo/scripts/Scripts","goo/util/gizmopack/Gizmo","goo/util/gizmopack/GizmoRenderSystem","goo/util/gizmopack/TranslationGizmo","goo/util/gizmopack/RotationGizmo","goo/util/gizmopack/ScaleGizmo"],function(e){var t=["goo/scripts/Scripts","goo/util/gizmopack/Gizmo","goo/util/gizmopack/GizmoRenderSystem","goo/util/gizmopack/TranslationGizmo","goo/util/gizmopack/RotationGizmo","goo/util/gizmopack/ScaleGizmo"];for(var n=1;n<t.length;n++){var r=t[n].slice(t[n].lastIndexOf("/")+1);e.addClass(r,arguments[n])}}),require(["goo/util/gizmopack/Gizmo","goo/util/gizmopack/GizmoRegister","goo/util/gizmopack/GizmoRenderSystem","goo/util/gizmopack/RotationGizmo","goo/util/gizmopack/ScaleGizmo","goo/util/gizmopack/TranslationGizmo"],function(e,t,n,r,i,s){var o=window.goo;if(!o)return;o.Gizmo=e,o.GizmoRegister=t,o.GizmoRenderSystem=n,o.RotationGizmo=r,o.ScaleGizmo=i,o.TranslationGizmo=s}),define("goo/util/gizmopack/gizmopack",function(){});
}try{
if(window.localStorage&&window.localStorage.gooPath){
window.require.config({
paths:{goo:localStorage.gooPath}
});
}else f()
}catch(e){f()}
})(window)