/* Goo Engine geometrypack 
 * Copyright 2014 Goo Technologies AB
 */
(function(window){function f(){
define("goo/geometrypack/FilledPolygon",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,t){function n(t,n){this.verts=t,this.indices=n?n:r(t);var i=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]);e.call(this,i,this.verts.length/3,this.indices.length),this.rebuild()}function r(e){var t=e.length/3;if(t<3)return[];var n=[],r=[];for(var o=0;o<t;o++)r.push(o);var o=0,u=t;while(u>3){var a=r[(o+0)%u],f=r[(o+1)%u],l=r[(o+2)%u],c=e[3*a],h=e[3*a+1],p=e[3*f],d=e[3*f+1],v=e[3*l],m=e[3*l+1],g=!1;if(s(c,h,p,d,v,m)){g=!0;for(var y=0;y<u;y++){var b=r[y];if(b===a||b===f||b===l)continue;if(i(e[3*b],e[3*b+1],c,h,p,d,v,m)){g=!1;break}}}if(g)n.push(a,f,l),r.splice((o+1)%u,1),u--,o=0;else if(o++>3*u)break}return n.push(r[0],r[1],r[2]),n}function i(e,t,n,r,i,s,o,u){var a=o-n,f=u-r,l=i-n,c=s-r,h=e-n,p=t-r,d=a*a+f*f,v=a*l+f*c,m=a*h+f*p,g=l*l+c*c,y=l*h+c*p,b=1/(d*g-v*v),w=(g*m-v*y)*b,E=(d*y-v*m)*b;return w>=0&&E>=0&&w+E<1}function s(e,t,n,r,i,s){return(t-r)*(i-n)+(n-e)*(s-r)>=0}function o(e){var t=e[0],n=e[0],r=e[1],i=e[1];for(var s=3;s<e.length;s+=3)t=t<e[s+0]?t:e[s+0],n=n>e[s+0]?n:e[s+0],r=r<e[s+1]?r:e[s+1],i=i>e[s+1]?i:e[s+1];return{minX:t,maxX:n,minY:r,maxY:i}}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var n=[];for(var r=0;r<this.indices.length;r+=3){var i=t.getTriangleNormal(this.verts[this.indices[r+0]*3+0],this.verts[this.indices[r+0]*3+1],this.verts[this.indices[r+0]*3+2],this.verts[this.indices[r+1]*3+0],this.verts[this.indices[r+1]*3+1],this.verts[this.indices[r+1]*3+2],this.verts[this.indices[r+2]*3+0],this.verts[this.indices[r+2]*3+1],this.verts[this.indices[r+2]*3+2]);n[this.indices[r+0]*3+0]=i[0],n[this.indices[r+0]*3+1]=i[1],n[this.indices[r+0]*3+2]=i[2],n[this.indices[r+1]*3+0]=i[0],n[this.indices[r+1]*3+1]=i[1],n[this.indices[r+1]*3+2]=i[2],n[this.indices[r+2]*3+0]=i[0],n[this.indices[r+2]*3+1]=i[1],n[this.indices[r+2]*3+2]=i[2]}this.getAttributeBuffer(e.NORMAL).set(n),this.getIndexBuffer().set(this.indices);var s=[],u=o(this.verts),a=u.maxX-u.minX,f=u.maxY-u.minY;for(var r=0;r<this.verts.length;r+=3){var l=(this.verts[r+0]-u.minX)/a,c=(this.verts[r+1]-u.minY)/f;s.push(l,c)}return this.getAttributeBuffer(e.TEXCOORD0).set(s),this},n}),define("goo/geometrypack/Surface",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,t){function n(t,n,r){this.verts=t,this.vertsPerLine=n||2,this.verticallyClosed=!!r;var i=e.defaultMap([e.POSITION,e.NORMAL,e.TEXCOORD0]),s=this.verts.length/3,o=s/this.vertsPerLine;e.call(this,i,s,(o-1)*(this.vertsPerLine-1)*6),this.rebuild()}function r(e){var t=e[0],n=e[0],r=e[1],i=e[1];for(var s=3;s<e.length;s+=3)t=t<e[s+0]?t:e[s+0],n=n>e[s+0]?n:e[s+0],r=r<e[s+2]?r:e[s+2],i=i>e[s+2]?i:e[s+2];return{minX:t,maxX:n,minY:r,maxY:i}}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var n=[],i=[],s=[],o=this.verts.length/3,u=o/this.vertsPerLine;for(var a=0;a<u-1;a++){for(var f=0;f<this.vertsPerLine-1;f++){var l=(a+0)*this.vertsPerLine+(f+0),c=(a+1)*this.vertsPerLine+(f+0),h=(a+1)*this.vertsPerLine+(f+1),p=(a+0)*this.vertsPerLine+(f+1);n.push(l,c,p,p,c,h),s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}if(this.verticallyClosed){var l=(a+0)*this.vertsPerLine+0,c=(a+1)*this.vertsPerLine+0,p=(a+0)*this.vertsPerLine+1;s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}else i.push(s[0],s[1],s[2])}a--;for(var f=0;f<this.vertsPerLine-1;f++){var l=(a+0)*this.vertsPerLine+(f+0),c=(a+1)*this.vertsPerLine+(f+0),p=(a+0)*this.vertsPerLine+(f+1);s=t.getTriangleNormal(this.verts[l*3+0],this.verts[l*3+1],this.verts[l*3+2],this.verts[c*3+0],this.verts[c*3+1],this.verts[c*3+2],this.verts[p*3+0],this.verts[p*3+1],this.verts[p*3+2]),i.push(s[0],s[1],s[2])}i.push(s[0],s[1],s[2]),this.getAttributeBuffer(e.NORMAL).set(i),this.getIndexBuffer().set(n);var d=[],v=r(this.verts),m=v.maxX-v.minX,g=v.maxY-v.minY;for(var a=0;a<this.verts.length;a+=3){var y=(this.verts[a+0]-v.minX)/m,b=(this.verts[a+2]-v.minY)/g;d.push(y,b)}return this.getAttributeBuffer(e.TEXCOORD0).set(d),this},n.createFromHeightMap=function(e,t,r,i){t=t||1,r=r||1,i=i||1;var s=[];for(var o=0;o<e.length;o++)for(var u=0;u<e[o].length;u++)s.push(o*t,e[o][u]*r,u*i);return s.reverse(),new n(s,e[0].length)},n.createTessellatedFlat=function(e,t,r,i){var s=[];for(var o=0;o<r;o++)for(var u=0;u<i;u++)s.push(o*e/r-e*.5,u*t/i-t*.5,0);var a=new n(s,r);return a},n}),define("goo/geometrypack/PolyLine",["goo/renderer/MeshData","goo/geometrypack/Surface"],function(e,t){function n(t,n){this.verts=t,this.closed=!!n;var r=e.defaultMap([e.POSITION]);e.call(this,r,this.verts.length/3,this.verts.length/3),this.closed?this.indexModes=["LineLoop"]:this.indexModes=["LineStrip"],this.rebuild()}function r(e,t,n,r){var i=Math.sqrt(e*e+t*t),s=e/i,o=t/i,u=Math.sqrt(n*n+r*r),a=n/u,f=r/u;return Math.atan2(o+f,s+a)-Math.PI/2}function i(e,t){var n=e.length/3,i,s,o,u,a,f;return t===0?(o=e[0],u=e[2],a=e[3],f=e[5],Math.atan2(f-u,a-o)-Math.PI/2):t===n-1?(i=e[(n-2)*3+0],s=e[(n-2)*3+2],o=e[(n-1)*3+0],u=e[(n-1)*3+2],Math.atan2(u-s,o-i)-Math.PI/2):(i=e[(t-1)*3+0],s=e[(t-1)*3+2],o=e[t*3+0],u=e[t*3+2],a=e[(t+1)*3+0],f=e[(t+1)*3+2],r(o-i,u-s,a-o,f-u))}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var t=[],n=this.verts.length/3;for(var r=0;r<n;r++)t.push(r);return this.getIndexBuffer().set(t),this},n.prototype.mul=function(e){if(e instanceof n){var r=e.verts.length/3,i=[];for(var s=0;s<this.verts.length;s+=3)for(var o=0;o<e.verts.length;o+=3)i.push(this.verts[s+0]+e.verts[o+0],this.verts[s+1]+e.verts[o+1],this.verts[s+2]+e.verts[o+2]);return new t(i,r)}return},n.prototype.pipe=function(e){if(e instanceof n){var r=e.verts.length/3,s=[];for(var o=0;o<this.verts.length;o+=3){var u=i(this.verts,o/3);for(var a=0;a<e.verts.length;a+=3)s.push(this.verts[o+0]+e.verts[a+2]*Math.cos(u),this.verts[o+1]+e.verts[a+1],this.verts[o+2]+e.verts[a+2]*Math.sin(u))}return new t(s,r)}console.error("pipe operation can only be applied to PolyLines");return},n.prototype.lathe=function(e){e=e||8;var n=Math.PI*2/e,r=[];for(var i=0;i<this.verts.length;i+=3)for(var s=0,o=0;s<=e;s++,o+=n)r.push(Math.cos(o)*this.verts[i+0],this.verts[i+1],Math.sin(o)*this.verts[i+0]);return new t(r,e+1,!0)},n.prototype.concat=function(e,t){if(e instanceof n)return new n(this.verts.concat(e.verts),t);console.error("concat operation can only be applied to PolyLines");return},n.fromCubicBezier=function(e,t,r){if(e.length!==12){console.error("PolyLine.fromCubicBezier takes an array of exactly 12 coordinates");return}t=t||16,r=r||0;var i=[],s=[],o=[],u=[],a=[],f=[],l=[];for(var c=r;c<=t;c++){var h=c/t;s[0]=e[0]+(e[3]-e[0])*h,s[1]=e[1]+(e[4]-e[1])*h,s[2]=e[2]+(e[5]-e[2])*h,o[0]=e[3]+(e[6]-e[3])*h,o[1]=e[4]+(e[7]-e[4])*h,o[2]=e[5]+(e[8]-e[5])*h,u[0]=e[6]+(e[9]-e[6])*h,u[1]=e[7]+(e[10]-e[7])*h,u[2]=e[8]+(e[11]-e[8])*h,a[0]=s[0]+(o[0]-s[0])*h,a[1]=s[1]+(o[1]-s[1])*h,a[2]=s[2]+(o[2]-s[2])*h,f[0]=o[0]+(u[0]-o[0])*h,f[1]=o[1]+(u[1]-o[1])*h,f[2]=o[2]+(u[2]-o[2])*h,l[0]=a[0]+(f[0]-a[0])*h,l[1]=a[1]+(f[1]-a[1])*h,l[2]=a[2]+(f[2]-a[2])*h,i.push(l[0],l[1],l[2])}return i=e.slice(0,3).concat(i),new n(i)},n.fromQuadraticSpline=function(e,t,r){if(e.length%3!==0&&e.length/3%2!==0){console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromQuadraticSpline");return}var i=[];for(var s=0;s<e.length-6;s+=6){var o=e.slice(s,s+3),u=e.slice(s+3,s+6),a=e.slice(s+6,s+9);i.push.apply(i,[o[0],o[1],o[2],o[0]+2/3*(u[0]-o[0]),o[1]+2/3*(u[1]-o[1]),o[2]+2/3*(u[2]-o[2]),a[0]+2/3*(u[0]-a[0]),a[1]+2/3*(u[1]-a[1]),a[2]+2/3*(u[2]-a[2])])}return i.push.apply(i,e.slice(e.length-3,e.length)),n.fromCubicSpline(i,t,r)},n.fromCubicSpline=function(e,t,r){if(r){if(e.length%3!==0&&e.length/3%3!==0){console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline");return}var i=e.length/3,s=i/3,o=n.fromCubicBezier(e.slice(0,12),t,1);for(var u=1;u<s-1;u++){var a=n.fromCubicBezier(e.slice(u*3*3,u*3*3+12),t,1);o=o.concat(a)}var a=n.fromCubicBezier(e.slice(u*3*3,u*3*3+9).concat(e.slice(0,3)),t,1);return o=o.concat(a),o}if(e.length%3!==0&&e.length/3%3!==1){console.error("Wrong number of coordinates supplied in first argument to PolyLine.fromCubicSpline");return}var i=e.length/3,s=(i-1)/3,o=n.fromCubicBezier(e.slice(0,12),t,1);for(var u=1;u<s;u++){var a=n.fromCubicBezier(e.slice(u*3*3,u*3*3+12),t,1);o=o.concat(a)}return o},n}),define("goo/geometrypack/RegularPolygon",["goo/renderer/MeshData","goo/geometrypack/PolyLine"],function(e,t){function n(e,n){this.nSegments=e||5,this.radius=n||1;var r=[],i=Math.PI*2/e;for(var s=0,o=0;s<this.nSegments;s++,o+=i)r.push(Math.cos(o)*this.radius,Math.sin(o)*this.radius,0);t.call(this,r,!0),this.rebuild()}return n.prototype=Object.create(t.prototype),n}),define("goo/geometrypack/Triangle",["goo/renderer/MeshData","goo/math/MathUtils"],function(e,t){function n(t){this.verts=t;var n=e.defaultMap([e.POSITION,e.NORMAL]);e.call(this,n,3,3),this.rebuild()}return n.prototype=Object.create(e.prototype),n.prototype.rebuild=function(){this.getAttributeBuffer(e.POSITION).set(this.verts);var n=t.getTriangleNormal(this.verts[0],this.verts[1],this.verts[2],this.verts[3],this.verts[4],this.verts[5],this.verts[6],this.verts[7],this.verts[8]);return this.getAttributeBuffer(e.NORMAL).set([n[0],n[1],n[2],n[0],n[1],n[2],n[0],n[1],n[2]]),this.getIndexBuffer().set([0,1,2]),this},n}),require(["goo/geometrypack/FilledPolygon","goo/geometrypack/PolyLine","goo/geometrypack/RegularPolygon","goo/geometrypack/Surface","goo/geometrypack/Triangle"],function(e,t,n,r,i){var s=window.goo;if(!s)return;s.FilledPolygon=e,s.PolyLine=t,s.RegularPolygon=n,s.Surface=r,s.Triangle=i}),define("goo/geometrypack/geometrypack",function(){});
}try{
if(window.localStorage&&window.localStorage.gooPath){
window.require.config({
paths:{goo:localStorage.gooPath}
});
}else f()
}catch(e){f()}
})(window,undefined)